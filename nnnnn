<?php
session_start();
if (!isset($_GET['status']) || !isset($_GET['exttrid'])) header('Location: index.php?status=invalid');
if (isset($_GET['status']) && empty($_GET['status'])) header('Location: index.php?status=invalid');
if (isset($_GET['exttrid']) && empty($_GET['exttrid'])) header('Location: index.php?status=invalid');
?>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="Keywords" content="RMU, University, Apply, Forms, School, Institution">
    <meta name="Description" content="The Regional Maritime University (RMU), Accra, Ghana, is an international tertiary institution. The overall objective for the establishment of RMU is to promote regional co-operation in the maritime industry focusing on the training to ensure the sustained growth and development of the industry.">
    <meta property="og:image" content="https://rmu.edu.gh/wp-content/uploads/2019/09/rmulogo-exp-3-400x75.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="400">
    <meta property="og:image:height" content="75">
    <meta property="og:description" content="Regional Maritime University (RMU) offers a comprehensive range of diploma and degree programs in Marine Engineering, Nautical Science, Electrical Engineering, Mechanical Engineering, Computer Science, Computer Engineering, Information Technology, Logistics, Port and Shipping Management, and other short courses. Explore our programs and gain expertise in the maritime industry. Join us and unlock your potential in the exciting world of maritime education.">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500&family=Roboto+Mono:wght@700&family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">
    <title>Form Purchase | Confirm Payment</title>
</head>

<body class="fluid-container">

    <main class="container flex-container" style="margin-bottom: 100px;">
        <div class="flex-card">
            <div class="form-card card">
                <div class="purchase-card-header mb-4">
                    <h1>Payment Status Confirmation</h1>
                </div>

                <div class="purchase-card-body">
                    <div class="pay-status" style="margin: 0px 10%;" style="align-items: baseline;">
                        <div class="d-flex justify-content-center">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p style="margin-left: 10px; margin-top:3px" id="status-out">Connecting...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function() {
            //get variable(parameters) from url
            function getUrlVars() {
                var vars = {};
                var parts = window.location.href.replace(
                    /[?&]+([^=&]+)=([^&]*)/gi,
                    function(m, key, value) {
                        vars[key] = value;
                    }
                );
                return vars;
            }

            //Use a default value when param is missing
            function getUrlParam(parameter, defaultvalue) {
                var urlparameter = defaultvalue;
                if (window.location.href.indexOf(parameter) > -1) {
                    urlparameter = getUrlVars()[parameter];
                }
                return urlparameter;
            }

            if (getUrlVars()["status"] != "" || getUrlVars()["status"] != undefined) {
                if (getUrlVars()["exttrid"] != "" || getUrlVars()["exttrid"] != undefined) {
                    let connect = 15000;
                    let init = 15000;
                    setTimeout(function() {
                        $("#status-out").text("Initializing...");
                        setTimeout(function() {
                            $.ajax({
                                type: "POST",
                                url: "confirm-payment.php",
                                data: {
                                    status: getUrlVars()["status"],
                                    exttrid: getUrlVars()["exttrid"],
                                },
                                success: function(result) {
                                    console.log(result);
                                    var parsedResult = JSON.parse(result);
                                    console.log(parsedResult);
									
									if (parsedResult.success) {
                                    	$(".pay-status").html("").append(parsedResult.message + '<br><div><a href="../assign_room/">Go back</a></div>');
										setTimeout(function() {
											window.location.href = '../assign_room/'
										}, 5000);
									} else {
										//HJ changed assign_room to dashboard, 09/05/2024
										setTimeout(function() {
											window.location.href = '../dashboard/'
										}, 5000);
									}
                                },
                                error: function(error) {
                                    console.log(error.statusText);
                                }
                            });
                        }, init);

                    }, connect);
                }
            }

            $(document).on({
                ajaxStart: function() {
                    //$(".pay-status").removeClass("hide");
                    $("#status-out").text("Processing...");
                },
                ajaxStop: function() {
                    $(".pay-status").removeClass("hide");
                }
            });

        });
    </script>

</body>

</html>